<p>You can find on the internet various wordlists focused on cracking wifi passwords, but it’s not the best wordlists to use in Brazil, so what about get some real brazilian passwords? There is an app called <a href="http://wifimagic.com/" target="_blank">MandicMagic</a>, it’s a social network, where the users save password of wifi network that they use or used sometime, well here is our honeypot, we just need to intercept the requests and try to discover how the app works.
In my first attempt I failed, because all the requests made by the app are pinned, but thanks to  <a href="https://github.com/ac-pm/Inspeckage" target="_blank">Inspeckage</a> was really easy to bypass it, the Inspeckage hooks the pinning function, I’ve just followed the tutorial of how to use <a href="https://acpm.mobi/genymotion-xposed-inspeckage/" target="_blank">Genymotion + Inspeckage + Xposed</a> and intercept all the app requests.</p>

<p>Unfortunately the app does not work how I expect, because it does not use geographic coordinates, there to parameters x and y, and I can’t figure out what they are, but I played with this numbers and get to different places, because the response shows the geographic coordinates of the wifi hotspot.</p>

<p>Here is the result I got so far, the function searchWifi is where you have the parameters x and y to play with,</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">searchWifi</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">'https://api.mandicmagic.com/v4/passwords/search?x=</span><span class="si">%</span><span class="s">d&amp;y=</span><span class="si">%</span><span class="s">d'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="n">headers</span><span class="p">[</span><span class="s">'Authorization'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Digest username="750910213", realm="Protected Area", nonce="59bc6c27d757f", uri="/v4/passwords/search?x=5585&amp;y=11071", response="5964e263fe176915645de1781b6d2b6e", qop=auth, nc=00000003, cnonce="51d6086c0c99359d", algorithm=MD5, opaque="2929b8e007e9c3edd69d915068815d71""'</span>
    <span class="n">headers</span><span class="p">[</span><span class="s">'Connection'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'close'</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">datas</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">datas</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">'Name: </span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">'SSID: </span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="s">'ssid'</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">'Pass: </span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="s">'password'</span><span class="p">]</span>
	<span class="k">print</span> <span class="s">'Latitude:  </span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="s">'lat'</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">'Longitude:  </span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="s">'lng'</span><span class="p">]</span>
	<span class="k">print</span>

<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="n">password</span><span class="p">):</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">headers</span><span class="p">[</span><span class="s">'Authorization'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Digest username="562939110", realm="Protected Area", nonce="59bc6d0e57949", uri="/v4/users/login", response="b33fb67d794b23b2c9a989120707c283", qop=auth, nc=00000003, cnonce="08ec0e86bc30740b", algorithm=MD5, opaque="2929b8e007e9c3edd69d915068815d71"'</span>
    <span class="n">headers</span><span class="p">[</span><span class="s">'User-Agent'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'WiFi Magic 3.3.15(android)'</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">'https://api.mandicmagic.com/v4/users/login'</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">"email"</span><span class="p">:</span><span class="n">username</span><span class="p">,</span><span class="s">"language"</span><span class="p">:</span><span class="s">"en"</span><span class="p">,</span><span class="s">"password"</span><span class="p">:</span><span class="n">password</span><span class="p">,</span><span class="s">"platform"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s">"version"</span><span class="p">:</span><span class="s">"3.3.15"</span><span class="p">}</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">headers</span><span class="p">[</span><span class="s">'API-token'</span><span class="p">]</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">quote_plus</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s">'token'</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">headers</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="n">headers</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="s">"email@email.com"</span><span class="p">,</span><span class="s">"yourpasswordhere"</span><span class="p">)</span>
<span class="k">if</span> <span class="n">headers</span><span class="p">:</span>
    <span class="n">searchWifi</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="mi">5533</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">11096</span><span class="p">)</span></code></pre></figure>

